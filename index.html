<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>✨ Magic To-Do</title>

<style>
    body { font-family: system-ui, -apple-system, sans-serif; max-width: 430px; margin: 50px auto; padding: 20px; background: #f4f4f9; }
    h1 { text-align: center; color: #333; margin-bottom: 25px; }

    #inputArea { display: flex; gap: 10px; margin-bottom: 20px; }
    #taskInput { flex-grow: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; }
    #addBtn { background: #2e7afe; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; }
    #addBtn:hover { background: #1764e8; }

    ul { list-style: none; padding: 0; }
    li { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }

    .left { display: flex; align-items: center; gap: 12px; }
    .completed { text-decoration: line-through; color: #888; }

    .delete-hint { font-size: 12px; color: #ff4d4d; opacity: 0; transition: 0.2s; }
    li:hover .delete-hint { opacity: 1; cursor: pointer; }
</style>
</head>
<body>

<h1>✨ Magic To-Do</h1>

<div id="inputArea">
    <input id="taskInput" placeholder="Enter a task..." maxlength="60">
    <button id="addBtn">Add</button>
</div>

<ul id="taskList">
    <li style="background:none; box-shadow:none; color:#888;">Loading data...</li>
</ul>

<script type="module">
/* ------------------ 1. Firebase CDN ------------------ */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
import { 
    getFirestore, collection, addDoc, deleteDoc, updateDoc,
    doc, onSnapshot, serverTimestamp, query, orderBy 
} from "https://www.gstatic.com/firebasejs/11.8.1/firebase-firestore.js";

/* ------------------ 2. Your Firebase Config ------------------ */
const firebaseConfig = {
  apiKey: "AIzaSyBCMiUx2oVDCI3uGkLUzi8_O0Id4qheGYM",
  authDomain: "class-todo-app-a5697.firebaseapp.com",
  projectId: "class-todo-app-a5697",
  storageBucket: "class-todo-app-a5697.firebasestorage.app",
  messagingSenderId: "652250810634",
  appId: "1:652250810634:web:1e10c2c157fb6b056e52f3"
};

/* ------------------ 3. Init Firebase ------------------ */
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const tasksCol = collection(db, "tasks");

/* ------------------ 4. UI Elements ------------------ */
const input = document.getElementById("taskInput");
const addBtn = document.getElementById("addBtn");
const taskList = document.getElementById("taskList");

/* ------------------ 5. Add Task ------------------ */
async function addTask() {
    const text = input.value.trim();
    if (!text) return;

    addBtn.disabled = true;
    addBtn.textContent = "Saving...";

    await addDoc(tasksCol, {
        text,
        completed: false,
        created: serverTimestamp()
    });

    input.value = "";
    addBtn.disabled = false;
    addBtn.textContent = "Add";
}
addBtn.onclick = addTask;
input.onkeydown = e => { if (e.key === "Enter") addTask(); };

/* ------------------ 6. Real-Time Sync ------------------ */
const q = query(tasksCol, orderBy("created", "desc"));

onSnapshot(q, (snapshot) => {
    taskList.innerHTML = "";

    if (snapshot.empty) {
        taskList.innerHTML = "<li style='background:none; box-shadow:none; color:#888;'>No tasks yet!</li>";
        return;
    }

    snapshot.forEach(docItem => {
        const data = docItem.data();
        const li = document.createElement("li");

        /* LEFT SIDE: checkbox + text */
        const left = document.createElement("div");
        left.className = "left";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = data.completed;

        const text = document.createElement("span");
        text.textContent = data.text;
        if (data.completed) text.classList.add("completed");

        checkbox.onchange = () => {
            updateDoc(doc(db, "tasks", docItem.id), {
                completed: checkbox.checked
            });
        };

        left.appendChild(checkbox);
        left.appendChild(text);
        li.appendChild(left);

        /* RIGHT SIDE: delete hint */
        const del = document.createElement("span");
        del.className = "delete-hint";
        del.textContent = "Delete";
        del.onclick = () => {
            if (confirm("Delete this task?")) {
                deleteDoc(doc(db, "tasks", docItem.id));
            }
        };

        li.appendChild(del);
        taskList.appendChild(li);
    });
});
</script>
</body>
</html>
